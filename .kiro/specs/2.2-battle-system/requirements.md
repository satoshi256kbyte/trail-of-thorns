# 要件定義書

## はじめに

この文書は、2D シミュレーションRPG「Trail of Thorns」における戦闘システムの要件を定義します。戦闘システムは、プレイヤーキャラクターと敵キャラクターの間で行われる攻撃・防御・ダメージ計算を管理し、戦略的なゲームプレイを提供します。

## 要件

### 要件1: 攻撃範囲計算システム

**ユーザーストーリー:** プレイヤーとして、キャラクターが攻撃可能な範囲を視覚的に確認できるようにしたい。これにより、戦略的な攻撃計画を立てることができる。

#### 受入基準

1. WHEN プレイヤーがキャラクターを選択して攻撃アクションを選択 THEN システムは攻撃可能範囲をハイライト表示する
2. WHEN キャラクターが異なる武器を装備 THEN システムは武器種別に応じた攻撃範囲を計算する
3. WHEN 攻撃範囲内に複数の敵が存在 THEN システムは全ての攻撃可能対象を識別する
4. WHEN 地形や障害物が攻撃経路を遮る THEN システムは攻撃不可能な対象を除外する
5. WHEN 範囲攻撃武器を使用 THEN システムは複数対象への攻撃範囲を表示する

### 要件2: 対象選択システム

**ユーザーストーリー:** プレイヤーとして、攻撃対象を明確に選択できるようにしたい。これにより、意図しない攻撃を防ぎ、戦術的な判断を行うことができる。

#### 受入基準

1. WHEN 攻撃範囲が表示されている状態で敵をクリック THEN システムは攻撃対象として選択する
2. WHEN 攻撃対象が選択された THEN システムは選択された対象を視覚的にハイライトする
3. WHEN 範囲攻撃の場合 THEN システムは影響を受ける全ての対象を表示する
4. WHEN 攻撃対象の選択をキャンセル THEN システムは攻撃範囲表示に戻る
5. WHEN 無効な対象を選択 THEN システムはエラーメッセージを表示する

### 要件3: ダメージ計算システム

**ユーザーストーリー:** プレイヤーとして、攻撃によるダメージが適切に計算されることを期待する。これにより、キャラクターの能力値と装備が戦闘結果に反映される。

#### 受入基準

1. WHEN キャラクターが攻撃を実行 THEN システムは攻撃力と防御力に基づいてダメージを計算する
2. WHEN 属性相性が存在 THEN システムは属性による倍率をダメージに適用する
3. WHEN クリティカルヒットが発生 THEN システムはダメージを1.5倍に増加させる
4. WHEN 攻撃が回避される THEN システムはダメージを0にする
5. WHEN ダメージが計算される THEN システムは最小1ダメージを保証する

### 要件4: 戦闘アニメーション・エフェクト

**ユーザーストーリー:** プレイヤーとして、戦闘の様子を視覚的に楽しめるようにしたい。これにより、ゲームの没入感と満足感を得ることができる。

#### 受入基準

1. WHEN 攻撃が実行される THEN システムは攻撃者の攻撃アニメーションを再生する
2. WHEN ダメージが発生 THEN システムはダメージエフェクトを表示する
3. WHEN HPが減少 THEN システムはHPバーの減少アニメーションを表示する
4. WHEN キャラクターが戦闘不能になる THEN システムは戦闘不能演出を再生する
5. WHEN 全てのアニメーションが完了 THEN システムは次のターンに進行する

### 要件5: 戦闘状態管理

**ユーザーストーリー:** プレイヤーとして、戦闘中のキャラクター状態が正確に管理されることを期待する。これにより、戦闘の結果が適切にゲーム進行に反映される。

#### 受入基準

1. WHEN キャラクターがダメージを受ける THEN システムは現在HPを更新する
2. WHEN キャラクターのHPが0になる THEN システムは戦闘不能状態に変更する
3. WHEN 戦闘不能キャラクターが存在 THEN システムはそのキャラクターの行動を無効化する
4. WHEN 戦闘が終了 THEN システムは戦闘結果をゲーム状態に反映する
5. WHEN 経験値が獲得される THEN システムは攻撃者の経験値を増加させる

### 要件6: 武器・装備システム連携

**ユーザーストーリー:** プレイヤーとして、キャラクターの装備が戦闘に適切に反映されることを期待する。これにより、装備による戦略的な差別化を図ることができる。

#### 受入基準

1. WHEN キャラクターが武器を装備 THEN システムは武器の攻撃力を戦闘計算に適用する
2. WHEN 武器に特殊効果がある THEN システムは効果を戦闘に反映する
3. WHEN 防具を装備 THEN システムは防御力を被ダメージ計算に適用する
4. WHEN 装備に属性がある THEN システムは属性相性を計算に含める
5. WHEN 装備が破損状態 THEN システムは性能低下を戦闘に反映する
