# SRPG実装タスク詳細

## フェーズ1: ゲーム基盤システム

### 1.1 ゲームプレイシーン基盤

#### タスク1.1.1: GameplaySceneの基本実装

- [ ] GameplayScene クラスの作成（Phaser.Scene継承）
- [ ] シーンの基本ライフサイクル（preload, create, update）実装
- [ ] ステージデータの読み込み機能
- [ ] シーン遷移（タイトル画面からの移行）
- [ ] 基本的なUI要素配置（ターン表示、メニューボタン）

#### タスク1.1.2: カメラシステム実装

- [ ] カメラコントローラークラス作成
- [ ] マップ境界に基づくカメラ制限
- [ ] スムーズなカメラ移動（tweening）
- [ ] ズーム機能（マウスホイール対応）
- [ ] キーボード/マウスでのカメラ操作

#### タスク1.1.3: 基本UI システム

- [ ] ゲーム内UIマネージャー作成
- [ ] ターン表示UI
- [ ] アクションメニューUI
- [ ] 情報パネル（キャラクター詳細表示）
- [ ] ポーズメニュー実装

### 1.2 マップ・タイルシステム

#### タスク1.2.1: タイルマップ基盤

- [ ] TileMap クラス実装
- [ ] グリッド座標システム（x,y → screen座標変換）
- [ ] タイル種類定義（地形、障害物、特殊タイル）
- [ ] マップデータ構造設計（JSON形式）
- [ ] タイルセット画像の読み込み・描画

#### タスク1.2.2: マップレンダリング

- [ ] MapRenderer クラス実装
- [ ] レイヤー管理（背景、オブジェクト、UI）
- [ ] 視界範囲内のみ描画（カリング）
- [ ] タイルアニメーション対応
- [ ] 地形効果の視覚表現

#### タスク1.2.3: マップエディター連携

- [ ] エディターで作成したマップデータの読み込み
- [ ] マップ検証機能（配置可能性チェック）
- [ ] デバッグ用マップ情報表示
- [ ] マップ切り替え機能

### 1.3 キャラクター基盤システム

#### タスク1.3.1: キャラクタークラス設計

- [ ] Character 基底クラス実装
- [ ] Unit クラス（プレイヤー・敵共通）
- [ ] キャラクター統計情報（HP, MP, ATK, DEF等）
- [ ] キャラクター状態管理（生存、状態異常等）
- [ ] キャラクターデータのJSON読み込み

#### タスク1.3.2: キャラクター描画システム

- [ ] スプライト管理システム
- [ ] キャラクターアニメーション（待機、移動、攻撃）
- [ ] 向き管理（4方向または8方向）
- [ ] HPバー・ステータス表示
- [ ] 選択状態の視覚表現

#### タスク1.3.3: キャラクター配置システム

- [ ] 初期配置システム（ステージデータから読み込み）
- [ ] キャラクター座標管理
- [ ] 配置可能位置の判定
- [ ] キャラクター同士の重複チェック

### 1.4 ターン制システム基盤

#### タスク1.4.1: ターンマネージャー

- [ ] TurnManager クラス実装
- [ ] ターン順序管理（速度ベース）
- [ ] プレイヤーターン・敵ターンの切り替え
- [ ] ターン終了条件の判定
- [ ] ターンカウンター管理

#### タスク1.4.2: アクションシステム

- [ ] Action 基底クラス（移動、攻撃、待機等）
- [ ] ActionQueue（アクション待ち行列）
- [ ] アクション実行・キャンセル機能
- [ ] アクション履歴（アンドゥ用）
- [ ] アクション検証システム

#### タスク1.4.3: ゲーム状態管理

- [ ] GameState クラス（現在の盤面状況）
- [ ] 状態の保存・復元機能
- [ ] 勝利・敗北条件の判定
- [ ] ゲーム進行状況の管理

## フェーズ2: 移動・戦闘システム

### 2.1 キャラクター移動システム

#### タスク2.1.1: 移動範囲計算

- [ ] MovementCalculator クラス実装
- [ ] キャラクターの移動力に基づく範囲計算
- [ ] 地形による移動コスト計算
- [ ] 障害物・他キャラクターによる移動制限
- [ ] 移動可能範囲の視覚表示

#### タスク2.1.2: パスファインディング

- [ ] A*アルゴリズム実装
- [ ] 最短経路計算
- [ ] 移動経路の視覚表示
- [ ] 経路上の移動コスト計算
- [ ] 複数経路の比較・選択

#### タスク2.1.3: 移動実行システム

- [ ] 移動アニメーション実装
- [ ] 段階的移動（1マスずつ）
- [ ] 移動中断・キャンセル機能
- [ ] 移動完了後の処理
- [ ] 移動に伴う状態変更

### 2.2 戦闘システム

#### タスク2.2.1: 攻撃範囲・対象選択

- [ ] 攻撃範囲計算システム
- [ ] 武器種別による範囲の違い
- [ ] 攻撃可能対象の判定
- [ ] 範囲攻撃の実装
- [ ] 対象選択UI

#### タスク2.2.2: ダメージ計算システム

- [ ] DamageCalculator クラス実装
- [ ] 基本ダメージ計算式
- [ ] 属性相性システム
- [ ] クリティカルヒット判定
- [ ] 防御力・回避率の計算

#### タスク2.2.3: 戦闘アニメーション

- [ ] 攻撃アニメーション実装
- [ ] ダメージエフェクト
- [ ] 戦闘結果表示
- [ ] HP減少アニメーション
- [ ] 戦闘不能演出

### 2.3 仲間化システム（ゲーム固有）

#### タスク2.3.1: 仲間化基盤システム

- [ ] RecruitmentSystem クラス実装
- [ ] 仲間化可能キャラクターの定義（JSONデータ）
- [ ] 仲間化条件の設定・管理
- [ ] 条件達成判定システム
- [ ] 仲間化フラグ管理

#### タスク2.3.2: NPC状態管理

- [ ] NPCStateManager クラス実装
- [ ] 敵→NPC状態変更処理
- [ ] NPC状態での行動制限
- [ ] 敵からの攻撃優先度設定（最高）
- [ ] NPC状態の視覚表現

#### タスク2.3.3: 仲間化UI・演出

- [ ] 仲間化条件表示UI
- [ ] 条件達成進捗表示
- [ ] NPC化演出
- [ ] 仲間化成功演出
- [ ] 仲間化失敗（NPC撃破）演出

### 2.4 キャラクターロストシステム（ゲーム固有）

#### タスク2.4.1: ロスト管理システム

- [ ] CharacterLossManager クラス実装
- [ ] 章内キャラクター状態管理
- [ ] ロスト発生時の処理
- [ ] ロストキャラクターの使用不可制御
- [ ] 章クリア時のロスト状態リセット

#### タスク2.4.2: ロストUI・演出

- [ ] キャラクターロスト演出
- [ ] ロスト状態の視覚表現
- [ ] パーティ編成でのロストキャラクター表示
- [ ] ロスト警告UI
- [ ] 章クリア時のロスト状態表示

### 2.5 スキル・アビリティシステム

#### タスク2.5.1: スキルシステム基盤

- [ ] Skill 基底クラス実装
- [ ] スキル種別定義（攻撃、回復、補助等）
- [ ] MP消費システム
- [ ] スキル使用条件判定
- [ ] スキルデータのJSON管理

#### タスク2.5.2: スキル効果実装

- [ ] ダメージスキル実装
- [ ] 回復スキル実装
- [ ] バフ・デバフスキル
- [ ] 状態異常付与スキル
- [ ] 特殊効果スキル

#### タスク2.5.3: スキルUI・演出

- [ ] スキル選択UI
- [ ] スキル効果範囲表示
- [ ] スキル発動演出
- [ ] スキル効果の視覚表現
- [ ] スキル説明・詳細表示

### 2.6 AIシステム

#### タスク2.6.1: AI基盤システム

- [ ] AIController 基底クラス
- [ ] 行動決定アルゴリズム
- [ ] 優先度ベース行動選択
- [ ] AIの思考時間制限
- [ ] デバッグ用AI思考表示

#### タスク2.6.2: AI行動パターン

- [ ] 攻撃的AI（最も近い敵を攻撃）
- [ ] 防御的AI（HP低下時に回避行動）
- [ ] 支援AI（味方の回復・補助）
- [ ] NPC保護AI（NPCを優先攻撃）
- [ ] 戦術的AI（地形を活用）

#### タスク2.6.3: AI難易度調整

- [ ] 難易度レベル設定
- [ ] AI思考深度の調整
- [ ] ランダム要素の調整
- [ ] プレイヤーレベルに応じた調整
- [ ] AI行動のバランス調整

## フェーズ3: 成長・進行システム

### 3.1 経験値・レベルアップシステム（ゲーム固有）

#### タスク3.1.1: 多様な経験値獲得システム

- [ ] ExperienceManager クラス実装
- [ ] 攻撃命中時の経験値獲得
- [ ] 敵撃破時の経験値獲得
- [ ] 味方支援・回復時の経験値獲得
- [ ] 経験値獲得の視覚表現

#### タスク3.1.2: レベルアップシステム

- [ ] レベルアップ判定
- [ ] 能力値成長計算
- [ ] レベルアップ演出
- [ ] 成長結果表示UI
- [ ] 能力値上限管理

### 3.2 職業・ランクアップシステム（ゲーム固有）

#### タスク3.2.1: 職業システム基盤

- [ ] JobSystem クラス実装
- [ ] 職業データ定義（JSON）
- [ ] 職業別能力値・スキル設定
- [ ] 職業変更システム
- [ ] 職業の視覚表現

#### タスク3.2.2: 薔薇の力・ランクアップシステム

- [ ] RoseEssenceManager クラス実装（薔薇の力管理）
- [ ] ボス撃破時の薔薇の力獲得
- [ ] ランクアップ可能判定
- [ ] ランクアップ実行システム
- [ ] ランクアップ演出・UI

#### タスク3.2.3: 職業ランクアップUI

- [ ] ランクアップ選択画面
- [ ] 職業ツリー表示
- [ ] ランクアップ効果プレビュー
- [ ] ランクアップ確認・実行UI
- [ ] 薔薇の力残量表示

### 3.3 ボス戦・勝利条件システム（ゲーム固有）

#### タスク3.3.1: ボス戦システム

- [ ] BossSystem クラス実装
- [ ] 魔性の薔薇の力を持つボス定義
- [ ] ボス専用AI・行動パターン
- [ ] ボス戦専用UI・演出
- [ ] ボス撃破時の特殊処理

#### タスク3.3.2: 勝利条件・目標システム

- [ ] ObjectiveManager クラス実装
- [ ] 目標種別定義（ボス撃破、全滅、到達等）
- [ ] 目標達成判定
- [ ] 複数目標の管理
- [ ] 目標表示UI

#### タスク3.3.3: ステージクリア報酬

- [ ] 報酬計算システム
- [ ] 薔薇の力獲得処理
- [ ] 経験値・アイテム報酬
- [ ] クリア評価システム
- [ ] 報酬表示・受け取りUI

### 3.4 章・ステージ管理システム（ゲーム固有）

#### タスク3.4.1: 章管理システム

- [ ] ChapterManager クラス実装
- [ ] 章データ構造設計（4-24ステージ）
- [ ] 章進行状況管理
- [ ] 章クリア条件判定
- [ ] 章間でのキャラクター状態管理

#### タスク3.4.2: パーティ編成システム

- [ ] PartyManager クラス実装
- [ ] 最大6人のパーティ編成
- [ ] ロストキャラクターの編成制限
- [ ] パーティ編成UI
- [ ] 編成バリデーション

#### タスク3.4.3: ステージ進行管理

- [ ] StageProgressManager クラス実装
- [ ] ステージ解放条件管理
- [ ] 進行状況保存・復元
- [ ] ステージ選択UI更新
- [ ] 進行状況表示
- [ ] 経験値テーブル管理
- [ ] 経験値表示UI

#### タスク3.2.2: 能力値成長

- [ ] 能力値成長計算
- [ ] 成長率設定システム
- [ ] レベルアップ時の能力値上昇
- [ ] 成長結果表示
- [ ] 能力値上限管理

#### タスク3.2.3: スキル習得

- [ ] スキル習得システム
- [ ] レベルによるスキル解放
- [ ] スキルツリー実装
- [ ] スキル習得UI
- [ ] 習得可能スキル表示

### 3.3 勝利条件・目標システム

#### タスク3.3.1: 目標管理システム

- [ ] Objective クラス実装
- [ ] 目標種別定義（全滅、到達、生存等）
- [ ] 目標達成判定
- [ ] 複数目標の管理
- [ ] 目標表示UI

#### タスク3.3.2: 勝利・敗北判定

- [ ] 勝利条件チェック
- [ ] 敗北条件チェック
- [ ] ゲーム終了処理
- [ ] 結果画面表示
- [ ] 次ステージへの遷移

#### タスク3.3.3: ステージクリア報酬

- [ ] 報酬計算システム
- [ ] 経験値・アイテム報酬
- [ ] クリア評価システム
- [ ] 報酬表示UI
- [ ] 報酬受け取り処理

## フェーズ4: システム統合・完成

### 4.1 セーブ・ロードシステム

#### タスク4.1.1: セーブデータ管理

- [ ] SaveManager クラス実装
- [ ] ゲーム進行状況の保存（章・ステージ進行）
- [ ] キャラクター状態の保存（レベル、職業、ロスト状態）
- [ ] 薔薇の力・仲間化状況の保存
- [ ] セーブデータの検証

#### タスク4.1.2: ロード機能

- [ ] セーブデータの読み込み
- [ ] ゲーム状態の復元
- [ ] データ整合性チェック
- [ ] ロードエラー処理
- [ ] バージョン互換性対応

#### タスク4.1.3: セーブ・ロードUI

- [ ] セーブスロット管理
- [ ] セーブ・ロード画面
- [ ] セーブデータ情報表示（章、進行状況等）
- [ ] セーブデータ削除機能
- [ ] オートセーブ機能

## 実装優先順位

### 最優先（MVP機能）

1. GameplayScene基盤
2. マップ・タイルシステム
3. キャラクター基盤
4. ターン制システム
5. 基本移動システム
6. 基本戦闘システム

### 最優先（ゲーム固有の核心機能）

1. **仲間化システム**: ゲームの最大の特徴
2. **キャラクターロストシステム**: 戦略性の核
3. **経験値システム（多様な獲得方法）**: 成長の実感
4. **ボス戦・薔薇の力システム**: 世界観との統合

### 高優先（コア機能）

1. **職業・ランクアップシステム**: 成長の多様性
2. **章・ステージ管理システム**: ゲーム進行の基盤
3. AI基本システム（NPC保護AI含む）
4. 勝利・敗北判定

### 中優先（体験向上）

1. スキルシステム基盤
2. セーブ・ロード
3. アニメーション・エフェクト
4. 詳細なAI

### 低優先（追加機能）

1. インベントリ・装備システム
2. サウンドシステム
3. チュートリアル
4. 高度なスキル効果

## ゲーム固有システムの実装順序

### 第1段階: 基本システム統合

1. 基本戦闘 + 仲間化システム
2. キャラクターロスト + 章管理
3. 経験値システム統合

### 第2段階: 成長システム統合

1. ボス戦 + 薔薇の力獲得
2. 職業・ランクアップシステム
3. パーティ編成システム

### 第3段階: 完成度向上

1. AI改良（NPC保護等）
2. UI/UX改善
3. バランス調整

## 各タスクの見積もり時間

### 小タスク（1-2日）

- 基本クラス実装
- 簡単なUI要素
- データ読み込み機能

### 中タスク（3-5日）

- システム間連携
- 複雑なアルゴリズム
- アニメーション実装

### 大タスク（1-2週間）

- 大規模システム設計
- 複数システムの統合
- 包括的なテスト実装

このタスク分解に基づいて、「魔性の薔薇」の世界観を持つSRPGとして、仲間化システムを核とした独自性のあるゲームを段階的に実装していきます。

## 重要な実装ポイント

### ゲーム固有システムの統合

- **仲間化システム**: 戦闘システムと密接に統合し、プレイヤーが条件を理解しやすいUI設計
- **キャラクターロスト**: 緊張感を生む一方で、プレイヤーの挫折を防ぐバランス調整
- **薔薇の力**: 世界観とシステムを結びつける重要な要素として丁寧に実装

### 開発時の注意点

- **段階的テスト**: 各ゲーム固有システムは独立してテスト可能な設計
- **データ駆動**: 仲間化条件、職業データ等はJSONで管理し、調整しやすく
- **プレイヤビリティ**: 複雑なシステムを直感的に理解できるUI/UX設計
